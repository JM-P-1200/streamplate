<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Edit Product - Streamplate</title>
  <link id="themeStylesheet" rel="stylesheet" href="../css/app-light.css">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
</head>
<body>

<div class="page-wrapper">
  <div class="content container-fluid">
    <div class="page-header">
      <h3 class="page-title">Edit Product</h3>
    </div>

    <div class="card">
      <div class="card-body">
        <form id="editForm">
          <input type="hidden" id="productId"/>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Product Name</label>
              <input id="name" type="text" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label>Price</label>
              <input id="price" type="number" class="form-control" min="0" required>
            </div>
            <div class="form-group col-md-3">
              <label>Category</label>
              <input id="category" type="text" class="form-control" required>
            </div>
          </div>

          <div class="form-group">
            <label>Image URL</label>
            <input id="image" type="url" class="form-control">
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea id="description" class="form-control" rows="4"></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Update Product</button>
          <a href="products-list.html" class="btn btn-outline-secondary">Back</a>
        </form>
      </div>
    </div>

  </div>
</div>

<script src="../js/jquery.min.js"></script>
<script>
const STORAGE_KEY = "streamplate_products_v1";

function getProducts(){ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
function saveProducts(ps){ localStorage.setItem(STORAGE_KEY, JSON.stringify(ps)); }

function getIdFromQuery(){ const params = new URLSearchParams(location.search); return Number(params.get("id")); }

function loadProductToForm(){
  const id = getIdFromQuery();
  if(!id){ alert("No product id"); return; }
  const ps = getProducts();
  const p = ps.find(x=>x.id === id);
  if(!p){ alert("Product not found"); window.location.href="products-list.html"; return; }

  $("#productId").val(p.id);
  $("#name").val(p.name);
  $("#price").val(p.price);
  $("#category").val(p.category);
  $("#image").val(p.image);
  $("#description").val(p.description);
}

$("#editForm").on("submit", function(e){
  e.preventDefault();
  const id = Number($("#productId").val());
  const ps = getProducts();
  const idx = ps.findIndex(x=>x.id === id);
  if(idx === -1){ alert("Product not found"); return; }

  ps[idx].name = $("#name").val().trim();
  ps[idx].price = Number($("#price").val());
  ps[idx].category = $("#category").val().trim();
  ps[idx].image = $("#image").val().trim() || "https://via.placeholder.com/200";
  ps[idx].description = $("#description").val().trim();

  ProductAPI.update(id, data).then(() => {
  alert("Updated");
  location.href = "products-list.html";
});
});

$(document).ready(loadProductToForm);
</script>

</body>
</html>
